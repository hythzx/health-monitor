# æœåŠ¡å¥åº·ç›‘æ§ç³»ç»Ÿ - å®Œæ•´é…ç½®ç¤ºä¾‹
# æœ¬æ–‡ä»¶å±•ç¤ºäº†æ‰€æœ‰æ”¯æŒçš„é…ç½®é€‰é¡¹å’Œæœ€ä½³å®è·µ

# ============================================================================
# å…¨å±€é…ç½®
# ============================================================================
global:
  # é»˜è®¤æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰- å¦‚æœæœåŠ¡æ²¡æœ‰å•ç‹¬é…ç½®check_intervalï¼Œå°†ä½¿ç”¨æ­¤å€¼
  check_interval: 30
  
  # æ—¥å¿—çº§åˆ«: DEBUG, INFO, WARNING, ERROR, CRITICAL
  log_level: INFO
  
  # æ—¥å¿—æ–‡ä»¶è·¯å¾„ - å¦‚æœä¸æŒ‡å®šï¼Œå°†åªè¾“å‡ºåˆ°æ§åˆ¶å°
  log_file: /var/log/health-monitor.log
  
  # æ—¥å¿—æ–‡ä»¶æœ€å¤§å¤§å°ï¼ˆMBï¼‰- è¶…è¿‡æ­¤å¤§å°å°†è¿›è¡Œè½®è½¬
  log_max_size: 100
  
  # ä¿ç•™çš„æ—¥å¿—æ–‡ä»¶æ•°é‡
  log_backup_count: 5

# ============================================================================
# æœåŠ¡ç›‘æ§é…ç½®
# ============================================================================
services:
  # Redis ç¼“å­˜æœåŠ¡ç›‘æ§
  redis-cache:
    type: redis
    host: localhost
    port: 6379
    password: "your_redis_password"  # å¯é€‰ï¼Œå¦‚æœRedisè®¾ç½®äº†å¯†ç 
    database: 0                      # Redisæ•°æ®åº“ç¼–å·ï¼Œé»˜è®¤ä¸º0
    timeout: 5                       # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
    check_interval: 10               # æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰
    
    # é«˜çº§é€‰é¡¹
    test_operations: true            # æ˜¯å¦æ‰§è¡ŒSET/GETæ“ä½œæµ‹è¯•
    collect_info: true               # æ˜¯å¦æ”¶é›†RedisæœåŠ¡å™¨ä¿¡æ¯
    
  # Redis ä¼šè¯å­˜å‚¨ï¼ˆå¦ä¸€ä¸ªRediså®ä¾‹ï¼‰
  redis-session:
    type: redis
    host: redis-session.example.com
    port: 6379
    password: "session_redis_password"
    database: 1
    timeout: 3
    check_interval: 15
    test_operations: false           # ä¼šè¯å­˜å‚¨ä¸éœ€è¦æ“ä½œæµ‹è¯•
    collect_info: false

  # MySQL ä¸»æ•°æ®åº“
  user-database:
    type: mysql
    host: localhost
    port: 3306
    username: monitor_user
    password: "db_password"
    database: users                  # è¦è¿æ¥çš„æ•°æ®åº“å
    timeout: 10                      # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
    check_interval: 30               # æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰
    
    # é«˜çº§é€‰é¡¹
    test_queries: true               # æ˜¯å¦æ‰§è¡Œç‰ˆæœ¬æŸ¥è¯¢ç­‰æµ‹è¯•
    collect_status: true             # æ˜¯å¦æ”¶é›†æ•°æ®åº“çŠ¶æ€ä¿¡æ¯
    test_database_access: true       # æ˜¯å¦æµ‹è¯•æŒ‡å®šæ•°æ®åº“çš„è®¿é—®æƒé™

  # MySQL åªè¯»å‰¯æœ¬
  user-database-readonly:
    type: mysql
    host: mysql-readonly.example.com
    port: 3306
    username: readonly_user
    password: "readonly_password"
    database: users
    timeout: 8
    check_interval: 60               # åªè¯»å‰¯æœ¬æ£€æŸ¥é¢‘ç‡å¯ä»¥ä½ä¸€äº›
    test_queries: false              # åªè¯»å‰¯æœ¬ä¸éœ€è¦å¤æ‚æµ‹è¯•
    collect_status: false
    test_database_access: true

  # MongoDB æ–‡æ¡£æ•°æ®åº“
  document-store:
    type: mongodb
    host: localhost
    port: 27017
    username: mongo_user
    password: "mongo_password"
    database: documents              # è¦è¿æ¥çš„æ•°æ®åº“å
    timeout: 10                      # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
    check_interval: 20               # æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰
    
    # é«˜çº§é€‰é¡¹
    test_queries: true               # æ˜¯å¦æ‰§è¡Œé›†åˆåˆ—è¡¨æŸ¥è¯¢ç­‰æµ‹è¯•
    test_operations: false           # æ˜¯å¦æ‰§è¡Œæ–‡æ¡£æ’å…¥/æŸ¥è¯¢/åˆ é™¤æµ‹è¯•
    collect_status: true             # æ˜¯å¦æ”¶é›†æœåŠ¡å™¨çŠ¶æ€ä¿¡æ¯
    test_database_access: true       # æ˜¯å¦æµ‹è¯•æŒ‡å®šæ•°æ®åº“çš„è®¿é—®æƒé™

  # MongoDB é›†ç¾¤
  mongodb-cluster:
    type: mongodb
    host: mongodb-cluster.example.com
    port: 27017
    username: cluster_user
    password: "cluster_password"
    database: production
    timeout: 15
    check_interval: 30
    test_queries: true
    test_operations: false           # ç”Ÿäº§ç¯å¢ƒä¸å»ºè®®æ‰§è¡Œå†™æ“ä½œæµ‹è¯•
    collect_status: true
    test_database_access: true

  # EMQX MQTTæ¶ˆæ¯ä»£ç†
  message-broker:
    type: emqx
    host: localhost
    port: 1883                       # MQTTç«¯å£
    username: mqtt_user
    password: "mqtt_password"
    client_id: health_monitor        # MQTTå®¢æˆ·ç«¯ID
    timeout: 15                      # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
    check_interval: 20               # æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰
    
    # æ£€æŸ¥æ–¹æ³•: mqtt æˆ– http
    check_method: mqtt               # ä½¿ç”¨MQTTåè®®æ£€æŸ¥
    
    # é«˜çº§é€‰é¡¹
    test_pubsub: true                # æ˜¯å¦æµ‹è¯•å‘å¸ƒ/è®¢é˜…åŠŸèƒ½
    also_check_api: false            # æ˜¯å¦åŒæ—¶æ£€æŸ¥HTTP API
    
    # HTTP APIé…ç½®ï¼ˆå½“check_methodä¸ºhttpæˆ–also_check_apiä¸ºtrueæ—¶ä½¿ç”¨ï¼‰
    api_port: 18083                  # EMQXç®¡ç†APIç«¯å£
    api_username: admin              # APIç”¨æˆ·å
    api_password: public             # APIå¯†ç 
    collect_stats: false             # æ˜¯å¦æ”¶é›†ç»Ÿè®¡ä¿¡æ¯

  # EMQX é›†ç¾¤ï¼ˆé€šè¿‡HTTP APIæ£€æŸ¥ï¼‰
  emqx-cluster:
    type: emqx
    host: emqx-cluster.example.com
    port: 1883
    username: cluster_mqtt_user
    password: "cluster_mqtt_password"
    client_id: health_monitor_cluster
    timeout: 20
    check_interval: 30
    
    check_method: http               # ä½¿ç”¨HTTP APIæ£€æŸ¥
    api_port: 18083
    api_username: admin
    api_password: cluster_admin_password
    collect_stats: true              # æ”¶é›†é›†ç¾¤ç»Ÿè®¡ä¿¡æ¯

  # RESTful API æœåŠ¡
  user-api:
    type: restful
    url: https://api.example.com/health
    method: GET                      # HTTPæ–¹æ³•: GET, POST, PUT, DELETE, HEAD, OPTIONS, PATCH
    timeout: 10                      # è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
    check_interval: 20               # æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰
    
    # HTTPé…ç½®
    headers:
      Authorization: "Bearer your_api_token"
      User-Agent: "HealthMonitor/1.0"
      Accept: "application/json"
    
    # å“åº”éªŒè¯
    expected_status: 200             # æœŸæœ›çš„HTTPçŠ¶æ€ç ï¼Œä¹Ÿå¯ä»¥æ˜¯åˆ—è¡¨ [200, 201, 202]
    expected_content: "healthy"      # æœŸæœ›å“åº”å†…å®¹åŒ…å«çš„å­—ç¬¦ä¸²
    validate_json: true              # æ˜¯å¦éªŒè¯JSONæ ¼å¼
    required_json_fields:            # å¿…éœ€çš„JSONå­—æ®µ
      - status
      - timestamp
    
    # é«˜çº§é€‰é¡¹
    collect_response_stats: true     # æ˜¯å¦æ”¶é›†å“åº”ç»Ÿè®¡ä¿¡æ¯

  # RESTful API - POSTè¯·æ±‚ç¤ºä¾‹
  notification-api:
    type: restful
    url: https://notification.example.com/api/health
    method: POST
    timeout: 8
    check_interval: 30
    
    headers:
      Content-Type: "application/json"
      X-API-Key: "your_notification_api_key"
    
    # POSTè¯·æ±‚æ•°æ®
    json:
      action: "health_check"
      source: "health_monitor"
    
    expected_status: [200, 201]      # æ¥å—å¤šä¸ªçŠ¶æ€ç 
    validate_json: true
    collect_response_stats: false

  # RESTful API - å¸¦è®¤è¯çš„æœåŠ¡
  admin-api:
    type: restful
    url: https://admin.example.com/api/status
    method: GET
    timeout: 12
    check_interval: 60               # ç®¡ç†APIæ£€æŸ¥é¢‘ç‡å¯ä»¥ä½ä¸€äº›
    
    # HTTPåŸºæœ¬è®¤è¯
    auth_username: admin_user
    auth_password: admin_password
    
    headers:
      Accept: "application/json"
    
    expected_status: 200
    expected_content: ["status", "ok"]  # å“åº”å¿…é¡»åŒ…å«è¿™äº›å­—ç¬¦ä¸²
    validate_json: true
    required_json_fields:
      - status
      - version
      - uptime

  # å¤–éƒ¨æœåŠ¡å¥åº·æ£€æŸ¥
  external-service:
    type: restful
    url: https://external-service.com/ping
    method: HEAD                     # HEADè¯·æ±‚åªæ£€æŸ¥è¿é€šæ€§ï¼Œä¸è·å–å“åº”ä½“
    timeout: 5
    check_interval: 120              # å¤–éƒ¨æœåŠ¡æ£€æŸ¥é¢‘ç‡æ›´ä½
    
    expected_status: [200, 204]
    collect_response_stats: false

# ============================================================================
# å‘Šè­¦é…ç½®
# ============================================================================
alerts:
  # é’‰é’‰æœºå™¨äººå‘Šè­¦
  - name: dingtalk-robot
    type: http
    url: "https://oapi.dingtalk.com/robot/send?access_token=YOUR_DINGTALK_TOKEN"
    method: POST
    timeout: 10                      # å‘Šè­¦å‘é€è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
    
    # é‡è¯•é…ç½®
    max_retries: 3                   # æœ€å¤§é‡è¯•æ¬¡æ•°
    retry_delay: 1.0                 # é‡è¯•å»¶è¿Ÿï¼ˆç§’ï¼‰
    retry_backoff: 2.0               # æŒ‡æ•°é€€é¿å€æ•°
    
    headers:
      Content-Type: "application/json"
    
    # æ¶ˆæ¯æ¨¡æ¿ï¼ˆæ”¯æŒå˜é‡æ›¿æ¢ï¼‰
    template: |
      {
        "msgtype": "text",
        "text": {
          "content": "ğŸš¨ æœåŠ¡å¥åº·å‘Šè­¦\n\næœåŠ¡åç§°: {{service_name}}\næœåŠ¡ç±»å‹: {{service_type}}\nå½“å‰çŠ¶æ€: {{status}}\nå‘ç”Ÿæ—¶é—´: {{timestamp}}\nå“åº”æ—¶é—´: {{response_time}}ms\né”™è¯¯ä¿¡æ¯: {{error_message}}\n\nè¯·åŠæ—¶å¤„ç†ï¼"
        }
      }

  # ä¼ä¸šå¾®ä¿¡æœºå™¨äººå‘Šè­¦
  - name: wechat-robot
    type: http
    url: "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=YOUR_WECHAT_KEY"
    method: POST
    timeout: 8
    max_retries: 2
    retry_delay: 0.5
    retry_backoff: 1.5
    
    headers:
      Content-Type: "application/json"
    
    template: |
      {
        "msgtype": "markdown",
        "markdown": {
          "content": "## ğŸš¨ æœåŠ¡å¥åº·å‘Šè­¦\n\n**æœåŠ¡åç§°**: {{service_name}}\n**æœåŠ¡ç±»å‹**: {{service_type}}\n**å½“å‰çŠ¶æ€**: <font color=\"warning\">{{status}}</font>\n**å‘ç”Ÿæ—¶é—´**: {{timestamp}}\n**å“åº”æ—¶é—´**: {{response_time}}ms\n**é”™è¯¯ä¿¡æ¯**: {{error_message}}"
        }
      }

  # Slackå‘Šè­¦
  - name: slack-webhook
    type: http
    url: "https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK"
    method: POST
    timeout: 10
    max_retries: 3
    retry_delay: 1.0
    retry_backoff: 2.0
    
    headers:
      Content-Type: "application/json"
    
    template: |
      {
        "text": "ğŸš¨ Service Health Alert",
        "attachments": [
          {
            "color": "danger",
            "fields": [
              {
                "title": "Service",
                "value": "{{service_name}} ({{service_type}})",
                "short": true
              },
              {
                "title": "Status",
                "value": "{{status}}",
                "short": true
              },
              {
                "title": "Time",
                "value": "{{timestamp}}",
                "short": true
              },
              {
                "title": "Response Time",
                "value": "{{response_time}}ms",
                "short": true
              },
              {
                "title": "Error",
                "value": "{{error_message}}",
                "short": false
              }
            ]
          }
        ]
      }

  # è‡ªå®šä¹‰Webhookå‘Šè­¦
  - name: custom-webhook
    type: http
    url: "https://your-webhook-endpoint.com/alerts"
    method: POST
    timeout: 15
    max_retries: 5
    retry_delay: 2.0
    retry_backoff: 1.5
    
    headers:
      Content-Type: "application/json"
      X-API-Key: "your-webhook-api-key"
      X-Source: "health-monitor"
    
    # è‡ªå®šä¹‰JSONæ ¼å¼
    template: |
      {
        "alert_type": "service_health",
        "severity": "critical",
        "service": {
          "name": "{{service_name}}",
          "type": "{{service_type}}",
          "status": "{{status}}"
        },
        "metrics": {
          "response_time_ms": {{response_time}},
          "timestamp": "{{timestamp}}"
        },
        "details": {
          "error_message": "{{error_message}}",
          "metadata": {{metadata_json}}
        }
      }

  # é‚®ä»¶å‘Šè­¦ï¼ˆé€šè¿‡HTTP APIï¼‰
  - name: email-alert
    type: http
    url: "https://api.sendgrid.com/v3/mail/send"
    method: POST
    timeout: 20
    max_retries: 3
    retry_delay: 1.0
    retry_backoff: 2.0
    
    headers:
      Authorization: "Bearer YOUR_SENDGRID_API_KEY"
      Content-Type: "application/json"
    
    template: |
      {
        "personalizations": [
          {
            "to": [
              {
                "email": "admin@example.com",
                "name": "System Administrator"
              }
            ],
            "subject": "ğŸš¨ Service Health Alert: {{service_name}}"
          }
        ],
        "from": {
          "email": "noreply@example.com",
          "name": "Health Monitor"
        },
        "content": [
          {
            "type": "text/html",
            "value": "<h2>Service Health Alert</h2><p><strong>Service:</strong> {{service_name}} ({{service_type}})</p><p><strong>Status:</strong> {{status}}</p><p><strong>Time:</strong> {{timestamp}}</p><p><strong>Response Time:</strong> {{response_time}}ms</p><p><strong>Error:</strong> {{error_message}}</p>"
          }
        ]
      }

# ============================================================================
# é…ç½®è¯´æ˜å’Œæœ€ä½³å®è·µ
# ============================================================================

# 1. æ£€æŸ¥é—´éš”å»ºè®®ï¼š
#    - å…³é”®æœåŠ¡ï¼ˆæ•°æ®åº“ã€ç¼“å­˜ï¼‰: 10-30ç§’
#    - ä¸€èˆ¬æœåŠ¡ï¼ˆAPIã€æ¶ˆæ¯é˜Ÿåˆ—ï¼‰: 30-60ç§’
#    - å¤–éƒ¨æœåŠ¡: 60-300ç§’
#    - ç®¡ç†æ¥å£: 60-600ç§’

# 2. è¶…æ—¶æ—¶é—´å»ºè®®ï¼š
#    - æœ¬åœ°æœåŠ¡: 3-10ç§’
#    - å†…ç½‘æœåŠ¡: 5-15ç§’
#    - å¤–ç½‘æœåŠ¡: 10-30ç§’

# 3. å‘Šè­¦é…ç½®å»ºè®®ï¼š
#    - é…ç½®å¤šä¸ªå‘Šè­¦æ¸ é“ä»¥ç¡®ä¿å¯é æ€§
#    - è®¾ç½®é€‚å½“çš„é‡è¯•æ¬¡æ•°å’Œå»¶è¿Ÿ
#    - ä½¿ç”¨æ¨¡æ¿è‡ªå®šä¹‰å‘Šè­¦æ¶ˆæ¯æ ¼å¼
#    - è€ƒè™‘å‘Šè­¦é¢‘ç‡é™åˆ¶ï¼Œé¿å…å‘Šè­¦é£æš´

# 4. å®‰å…¨å»ºè®®ï¼š
#    - ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†ç ã€APIå¯†é’¥ï¼‰
#    - ä¸ºç›‘æ§ç”¨æˆ·åˆ›å»ºä¸“é—¨çš„æ•°æ®åº“è´¦æˆ·ï¼Œåªæˆäºˆå¿…è¦æƒé™
#    - å®šæœŸè½®æ¢å¯†ç å’ŒAPIå¯†é’¥
#    - ä½¿ç”¨HTTPSè¿›è¡Œæ‰€æœ‰å¤–éƒ¨é€šä¿¡

# 5. æ€§èƒ½å»ºè®®ï¼š
#    - æ ¹æ®æœåŠ¡é‡è¦æ€§è°ƒæ•´æ£€æŸ¥é¢‘ç‡
#    - é¿å…åœ¨é«˜å³°æœŸè¿›è¡Œé¢‘ç¹æ£€æŸ¥
#    - ç›‘æ§ç³»ç»Ÿæœ¬èº«çš„èµ„æºä½¿ç”¨æƒ…å†µ
#    - è€ƒè™‘ä½¿ç”¨è¿æ¥æ± å‡å°‘è¿æ¥å¼€é”€