# å¥åº·ç›‘æ§ç³»ç»Ÿé…ç½®æ–‡ä»¶ - Docker Composeç‰ˆæœ¬
# æ­¤é…ç½®æ–‡ä»¶ç”¨äºDocker Composeç¯å¢ƒä¸‹çš„æ¼”ç¤º

# å…¨å±€é…ç½®
global:
  check_interval: 30                 # é»˜è®¤æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰
  max_concurrent_checks: 10          # æœ€å¤§å¹¶å‘æ£€æŸ¥æ•°
  log_level: INFO                    # æ—¥å¿—çº§åˆ«
  log_file: logs/health-monitor.log  # æ—¥å¿—æ–‡ä»¶è·¯å¾„
  log_max_size: 100                  # æ—¥å¿—æ–‡ä»¶æœ€å¤§å¤§å°ï¼ˆMBï¼‰
  log_backup_count: 5                # ä¿ç•™çš„æ—¥å¿—æ–‡ä»¶æ•°é‡
  state_file: logs/state.json        # çŠ¶æ€æŒä¹…åŒ–æ–‡ä»¶

# æœåŠ¡ç›‘æ§é…ç½®
services:
  # Redisç›‘æ§
  redis-demo:
    type: redis
    host: redis-demo                 # Docker ComposeæœåŠ¡å
    port: 6379
    timeout: 5
    check_interval: 10
    test_operations: true            # æ‰§è¡ŒSET/GETæµ‹è¯•
    collect_info: true               # æ”¶é›†æœåŠ¡å™¨ä¿¡æ¯

  # MySQLç›‘æ§
  mysql-demo:
    type: mysql
    host: mysql-demo                 # Docker ComposeæœåŠ¡å
    port: 3306
    username: monitor
    password: "monitor123"
    database: healthdb
    timeout: 10
    check_interval: 20
    test_queries: true               # æ‰§è¡Œæµ‹è¯•æŸ¥è¯¢
    collect_status: true             # æ”¶é›†æ•°æ®åº“çŠ¶æ€

  # MongoDBç›‘æ§
  mongodb-demo:
    type: mongodb
    host: mongodb-demo               # Docker ComposeæœåŠ¡å
    port: 27017
    username: admin
    password: "admin123"
    database: healthdb
    timeout: 10
    check_interval: 25
    test_queries: false              # ä¸æ‰§è¡Œæµ‹è¯•æŸ¥è¯¢ï¼ˆå¯èƒ½éœ€è¦æƒé™ï¼‰
    collect_status: true             # æ”¶é›†æœåŠ¡å™¨çŠ¶æ€

  # EMQX MQTTç›‘æ§
  emqx-demo:
    type: emqx
    host: emqx-demo                  # Docker ComposeæœåŠ¡å
    port: 1883
    timeout: 15
    check_interval: 30
    check_method: mqtt               # ä½¿ç”¨MQTTæ–¹å¼æ£€æŸ¥
    client_id: health_monitor_client
    test_pubsub: false               # ä¸æ‰§è¡Œå‘å¸ƒ/è®¢é˜…æµ‹è¯•

  # Web APIç›‘æ§
  api-demo:
    type: restful
    url: http://api-demo/health      # å†…éƒ¨å®¹å™¨åœ°å€
    method: GET
    timeout: 10
    check_interval: 15
    expected_status: 200
    headers:
      User-Agent: "HealthMonitor/1.0"
    validate_json: false             # ä¸éªŒè¯JSONæ ¼å¼
    collect_response_stats: true     # æ”¶é›†å“åº”ç»Ÿè®¡

# å‘Šè­¦é…ç½®
alerts:
  # é’‰é’‰æœºå™¨äººå‘Šè­¦ï¼ˆéœ€è¦é…ç½®çœŸå®Tokenï¼‰
  - name: dingtalk-demo
    type: http
    url: "https://oapi.dingtalk.com/robot/send?access_token=YOUR_DINGTALK_TOKEN"
    method: POST
    timeout: 10
    max_retries: 3
    retry_delay: 1.0
    retry_backoff: 2.0
    headers:
      Content-Type: "application/json"
    template: |
      {
        "msgtype": "text",
        "text": {
          "content": "ğŸš¨ å¥åº·ç›‘æ§å‘Šè­¦\nğŸ“Š æœåŠ¡: {{service_name}}\nğŸ“ˆ çŠ¶æ€: {{status}}\nâ° æ—¶é—´: {{timestamp}}\nâ— é”™è¯¯: {{error_message}}\nâš¡ å“åº”æ—¶é—´: {{response_time}}ms"
        }
      }

  # ä¼ä¸šå¾®ä¿¡æœºå™¨äººå‘Šè­¦ï¼ˆéœ€è¦é…ç½®çœŸå®Keyï¼‰
  - name: wechat-demo
    type: http
    url: "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=YOUR_WECHAT_KEY"
    method: POST
    timeout: 10
    headers:
      Content-Type: "application/json"
    template: |
      {
        "msgtype": "markdown",
        "markdown": {
          "content": "## ğŸš¨ æœåŠ¡å¥åº·ç›‘æ§å‘Šè­¦\n\n**æœåŠ¡åç§°**: {{service_name}}\n**æœåŠ¡ç±»å‹**: {{service_type}}\n**å½“å‰çŠ¶æ€**: <font color=\"warning\">{{status}}</font>\n**æ£€æŸ¥æ—¶é—´**: {{timestamp}}\n**å“åº”æ—¶é—´**: {{response_time}}ms\n**é”™è¯¯ä¿¡æ¯**: {{error_message}}\n\n> è¯·åŠæ—¶æ£€æŸ¥æœåŠ¡çŠ¶æ€å¹¶å¤„ç†ç›¸å…³é—®é¢˜"
        }
      }

  # æ§åˆ¶å°è¾“å‡ºå‘Šè­¦ï¼ˆç”¨äºæµ‹è¯•ï¼‰
  - name: console-output
    type: http
    url: "http://localhost:8080/webhook/test"  # æµ‹è¯•åœ°å€
    method: POST
    timeout: 5
    headers:
      Content-Type: "application/json"
    template: |
      {
        "alert_type": "health_monitor",
        "service": "{{service_name}}",
        "status": "{{status}}",
        "timestamp": "{{timestamp}}",
        "response_time": "{{response_time}}",
        "error": "{{error_message}}"
      } 