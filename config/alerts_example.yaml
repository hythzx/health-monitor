# å‘Šè­¦é…ç½®ç¤ºä¾‹æ–‡ä»¶
# å±•ç¤ºå¦‚ä½•é…ç½®HTTPã€é‚®ä»¶å’Œé˜¿é‡Œäº‘çŸ­ä¿¡å‘Šè­¦å™¨

# å…¨å±€é…ç½®
global:
  check_interval: 30  # é»˜è®¤æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰
  log_level: INFO
  log_file: /var/log/health-monitor.log

# æœåŠ¡ç›‘æ§é…ç½®
services:
  redis-cache:
    type: redis
    host: localhost
    port: 6379
    password: "your_password"
    database: 0
    timeout: 5
    check_interval: 10
    
  user-database:
    type: mysql
    host: localhost
    port: 3306
    username: monitor_user
    password: "db_password"
    database: users
    timeout: 10
    check_interval: 30

# å‘Šè­¦é…ç½®
alerts:
  # HTTPå‘Šè­¦å™¨ - é’‰é’‰æœºå™¨äºº
  - name: dingtalk-robot
    type: http
    url: "https://oapi.dingtalk.com/robot/send?access_token=YOUR_TOKEN"
    method: POST
    headers:
      Content-Type: "application/json"
    template: |
      {
        "msgtype": "text",
        "text": {
          "content": "ğŸš¨ æœåŠ¡å‘Šè­¦\næœåŠ¡åç§°: {{service_name}}\næœåŠ¡ç±»å‹: {{service_type}}\nçŠ¶æ€: {{status}}\næ—¶é—´: {{timestamp}}\né”™è¯¯ä¿¡æ¯: {{error_message}}\nå“åº”æ—¶é—´: {{response_time}}ms"
        }
      }
    max_retries: 3
    retry_delay: 1.0
    timeout: 30
    
  # HTTPå‘Šè­¦å™¨ - è‡ªå®šä¹‰Webhook
  - name: webhook-alert
    type: http
    url: "https://your-webhook.com/alerts"
    method: POST
    headers:
      Content-Type: "application/json"
      X-API-Key: "your-api-key"
    template: |
      {
        "service": "{{service_name}}",
        "type": "{{service_type}}",
        "status": "{{status}}",
        "timestamp": "{{timestamp}}",
        "error": "{{error_message}}",
        "response_time": {{response_time}}
      }
    max_retries: 2
    retry_delay: 2.0
    
  # é‚®ä»¶å‘Šè­¦å™¨ - Gmail SMTP
  - name: gmail-alert
    type: email
    smtp_server: smtp.gmail.com
    smtp_port: 587
    username: "your-email@gmail.com"
    password: "your-app-password"  # ä½¿ç”¨åº”ç”¨ä¸“ç”¨å¯†ç 
    use_tls: true
    from_email: "your-email@gmail.com"
    from_name: "æœåŠ¡å¥åº·ç›‘æ§ç³»ç»Ÿ"
    to_emails:
      - "admin@company.com"
      - "ops@company.com"
    cc_emails:
      - "manager@company.com"
    subject_template: "ğŸš¨ æœåŠ¡å‘Šè­¦: {{service_name}} - {{status}}"
    body_template: |
      æœåŠ¡å¥åº·ç›‘æ§å‘Šè­¦é€šçŸ¥
      
      ==========================================
      å‘Šè­¦è¯¦æƒ…
      ==========================================
      æœåŠ¡åç§°: {{service_name}}
      æœåŠ¡ç±»å‹: {{service_type}}
      å½“å‰çŠ¶æ€: {{status}}
      å‘ç”Ÿæ—¶é—´: {{timestamp}}
      å“åº”æ—¶é—´: {{response_time}}ms
      é”™è¯¯ä¿¡æ¯: {{error_message}}
      
      ==========================================
      å¤„ç†å»ºè®®
      ==========================================
      1. è¯·ç«‹å³æ£€æŸ¥æœåŠ¡çŠ¶æ€
      2. æŸ¥çœ‹ç›¸å…³æ—¥å¿—æ–‡ä»¶
      3. å¦‚éœ€è¦ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒ
      
      è¯·åŠæ—¶å¤„ç†ç›¸å…³é—®é¢˜ï¼
      
      ---
      æ­¤é‚®ä»¶ç”±æœåŠ¡å¥åº·ç›‘æ§ç³»ç»Ÿè‡ªåŠ¨å‘é€ï¼Œè¯·å‹¿å›å¤ã€‚
    max_retries: 3
    retry_delay: 2.0
    timeout: 30
    
  # é‚®ä»¶å‘Šè­¦å™¨ - ä¼ä¸šé‚®ç®± SMTP
  - name: enterprise-email
    type: email
    smtp_server: smtp.exmail.qq.com
    smtp_port: 465
    username: "monitor@company.com"
    password: "your-password"
    use_ssl: true  # ä½¿ç”¨SSLè€Œä¸æ˜¯TLS
    from_email: "monitor@company.com"
    from_name: "ç›‘æ§ç³»ç»Ÿ"
    to_emails:
      - "it-team@company.com"
    subject_template: "[{{status}}] {{service_name}} æœåŠ¡å‘Šè­¦"
    body_template: |
      {{service_name}} æœåŠ¡çŠ¶æ€å˜æ›´é€šçŸ¥
      
      çŠ¶æ€: {{status}}
      æ—¶é—´: {{timestamp}}
      é”™è¯¯: {{error_message}}
      
      è¯·åŠæ—¶å¤„ç†ã€‚
    max_retries: 2
    retry_delay: 1.5
    
  # é˜¿é‡Œäº‘çŸ­ä¿¡å‘Šè­¦å™¨
  - name: aliyun-sms-alert
    type: aliyun_sms
    access_key_id: "YOUR_ACCESS_KEY_ID"
    access_key_secret: "YOUR_ACCESS_KEY_SECRET"
    region: "cn-hangzhou"
    sign_name: "æ‚¨çš„ç­¾å"
    template_code: "SMS_123456789"  # æ‚¨çš„çŸ­ä¿¡æ¨¡æ¿ä»£ç 
    phone_numbers:
      - "13800138000"  # ç®¡ç†å‘˜æ‰‹æœºå·
      - "13900139000"  # è¿ç»´äººå‘˜æ‰‹æœºå·
    template_params:
      service: "{{service_name}}"
      status: "{{status}}"
      time: "{{timestamp}}"
    max_retries: 3
    retry_delay: 1.0
    batch_size: 100  # æ‰¹é‡å‘é€å¤§å°
    timeout: 30
    
  # é˜¿é‡Œäº‘çŸ­ä¿¡å‘Šè­¦å™¨ - ç´§æ€¥é€šçŸ¥
  - name: emergency-sms
    type: aliyun_sms
    access_key_id: "YOUR_ACCESS_KEY_ID"
    access_key_secret: "YOUR_ACCESS_KEY_SECRET"
    region: "cn-shanghai"
    sign_name: "ç´§æ€¥é€šçŸ¥"
    template_code: "SMS_987654321"
    phone_numbers:
      - "13800138000"  # æŠ€æœ¯è´Ÿè´£äºº
    template_params:
      service: "{{service_name}}"
      error: "{{error_message}}"
    max_retries: 5  # ç´§æ€¥é€šçŸ¥å¢åŠ é‡è¯•æ¬¡æ•°
    retry_delay: 0.5  # ç¼©çŸ­é‡è¯•é—´éš”
    batch_size: 50

# å‘Šè­¦è¿‡æ»¤é…ç½®ï¼ˆå¯é€‰ï¼‰
alert_filters:
  # åªåœ¨å·¥ä½œæ—¶é—´å‘é€é‚®ä»¶å‘Šè­¦
  - type: time_filter
    quiet_hours:
      - [22, 8]  # æ™šä¸Š10ç‚¹åˆ°æ—©ä¸Š8ç‚¹é™é»˜
  
  # åªå¯¹å…³é”®æœåŠ¡å‘é€çŸ­ä¿¡å‘Šè­¦
  - type: service_filter
    critical_services:
      - "user-database"
      - "payment-service"
      - "auth-service"