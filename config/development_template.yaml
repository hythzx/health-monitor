# å¼€å‘ç¯å¢ƒé…ç½®æ¨¡æ¿
# é€‚åˆå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒçš„é…ç½®ï¼Œæ³¨é‡è°ƒè¯•å’Œè¯¦ç»†ä¿¡æ¯

global:
  check_interval: 15        # å¼€å‘ç¯å¢ƒæ£€æŸ¥æ›´é¢‘ç¹ï¼Œä¾¿äºè°ƒè¯•
  log_level: DEBUG          # å¼€å‘ç¯å¢ƒè®°å½•è¯¦ç»†æ—¥å¿—
  log_file: logs/dev-health-monitor.log
  log_max_size: 50          # è¾ƒå°çš„æ—¥å¿—æ–‡ä»¶
  log_backup_count: 3

services:
  # æœ¬åœ°MySQLå¼€å‘æ•°æ®åº“
  dev-mysql:
    type: mysql
    host: localhost
    port: 3306
    username: dev_user
    password: "dev_password"
    database: development
    timeout: 5
    check_interval: 15
    test_queries: true        # å¼€å‘ç¯å¢ƒå¯ä»¥æ‰§è¡Œæµ‹è¯•æŸ¥è¯¢
    collect_status: true
    test_database_access: true

  # æœ¬åœ°Redis
  dev-redis:
    type: redis
    host: localhost
    port: 6379
    # password: ""            # å¼€å‘ç¯å¢ƒé€šå¸¸ä¸è®¾å¯†ç 
    database: 0
    timeout: 3
    check_interval: 10
    test_operations: true     # å¼€å‘ç¯å¢ƒå¯ä»¥æ‰§è¡Œè¯»å†™æµ‹è¯•
    collect_info: true

  # æœ¬åœ°MongoDB
  dev-mongodb:
    type: mongodb
    host: localhost
    port: 27017
    # username: ""            # å¼€å‘ç¯å¢ƒå¯èƒ½ä¸éœ€è¦è®¤è¯
    # password: ""
    database: dev_db
    timeout: 5
    check_interval: 20
    test_queries: true
    test_operations: true     # å¼€å‘ç¯å¢ƒå¯ä»¥æ‰§è¡Œæ–‡æ¡£æ“ä½œæµ‹è¯•
    collect_status: true
    test_database_access: true

  # æœ¬åœ°EMQX
  dev-emqx:
    type: emqx
    host: localhost
    port: 1883
    username: dev_user
    password: "dev_password"
    client_id: health_monitor_dev
    timeout: 10
    check_interval: 30
    check_method: mqtt        # å¼€å‘ç¯å¢ƒä½¿ç”¨MQTTæµ‹è¯•å®Œæ•´åŠŸèƒ½
    test_pubsub: true         # æµ‹è¯•å‘å¸ƒè®¢é˜…åŠŸèƒ½
    also_check_api: true      # åŒæ—¶æµ‹è¯•HTTP API
    api_port: 18083
    api_username: admin
    api_password: public
    collect_stats: true

  # æœ¬åœ°å¼€å‘API
  dev-api:
    type: restful
    url: http://localhost:8080/api/health
    method: GET
    timeout: 5
    check_interval: 15
    headers:
      Accept: "application/json"
      X-Environment: "development"
    expected_status: 200
    expected_content: "ok"
    validate_json: true
    required_json_fields:
      - status
    collect_response_stats: true

  # å‰ç«¯å¼€å‘æœåŠ¡å™¨
  frontend-dev:
    type: restful
    url: http://localhost:3000
    method: GET
    timeout: 3
    check_interval: 30
    expected_status: 200
    collect_response_stats: false

  # æµ‹è¯•APIç«¯ç‚¹
  test-api:
    type: restful
    url: http://localhost:8080/api/test
    method: POST
    timeout: 8
    check_interval: 60
    headers:
      Content-Type: "application/json"
      X-Test-Mode: "true"
    json:
      test: true
      timestamp: "{{timestamp}}"
    expected_status: [200, 201]
    validate_json: true
    collect_response_stats: true

  # å¤–éƒ¨æµ‹è¯•æœåŠ¡
  external-test:
    type: restful
    url: https://httpbin.org/status/200
    method: GET
    timeout: 10
    check_interval: 120       # å¤–éƒ¨æµ‹è¯•æœåŠ¡æ£€æŸ¥é¢‘ç‡ä½ä¸€äº›
    expected_status: 200
    collect_response_stats: false

alerts:
  # å¼€å‘ç¯å¢ƒæ§åˆ¶å°å‘Šè­¦ï¼ˆç”¨äºè°ƒè¯•ï¼‰
  - name: console-alert
    type: http
    url: "http://localhost:8080/dev/alerts"  # æœ¬åœ°å¼€å‘æœåŠ¡å™¨æ¥æ”¶å‘Šè­¦
    method: POST
    timeout: 5
    max_retries: 1            # å¼€å‘ç¯å¢ƒä¸éœ€è¦å¤ªå¤šé‡è¯•
    retry_delay: 0.5
    headers:
      Content-Type: "application/json"
      X-Environment: "development"
    template: |
      {
        "level": "warning",
        "service": "{{service_name}}",
        "type": "{{service_type}}",
        "status": "{{status}}",
        "timestamp": "{{timestamp}}",
        "response_time": {{response_time}},
        "error": "{{error_message}}",
        "metadata": {{metadata_json}}
      }

  # å¼€å‘å›¢é˜ŸSlacké¢‘é“
  - name: dev-slack
    type: http
    url: "https://hooks.slack.com/services/YOUR/DEV/WEBHOOK"
    method: POST
    timeout: 10
    max_retries: 2
    retry_delay: 1.0
    headers:
      Content-Type: "application/json"
    template: |
      {
        "channel": "#dev-alerts",
        "username": "Health Monitor Dev",
        "icon_emoji": ":warning:",
        "text": "ğŸ”§ Dev Environment Alert",
        "attachments": [
          {
            "color": "warning",
            "fields": [
              {
                "title": "Service",
                "value": "{{service_name}} ({{service_type}})",
                "short": true
              },
              {
                "title": "Status",
                "value": "{{status}}",
                "short": true
              },
              {
                "title": "Response Time",
                "value": "{{response_time}}ms",
                "short": true
              },
              {
                "title": "Error",
                "value": "{{error_message}}",
                "short": false
              }
            ]
          }
        ]
      }

  # å¼€å‘ç¯å¢ƒé‚®ä»¶é€šçŸ¥ï¼ˆå¯é€‰ï¼‰
  - name: dev-email
    type: http
    url: "http://localhost:1080/api/send"  # æœ¬åœ°é‚®ä»¶æµ‹è¯•æœåŠ¡
    method: POST
    timeout: 5
    max_retries: 1
    headers:
      Content-Type: "application/json"
    template: |
      {
        "to": "developer@localhost",
        "subject": "Dev Health Alert: {{service_name}}",
        "text": "Service: {{service_name}}\nType: {{service_type}}\nStatus: {{status}}\nTime: {{timestamp}}\nError: {{error_message}}"
      }

# å¼€å‘ç¯å¢ƒç‰¹ç‚¹ï¼š
# 1. æ›´é¢‘ç¹çš„æ£€æŸ¥é—´éš”ï¼Œä¾¿äºå¿«é€Ÿå‘ç°é—®é¢˜
# 2. è¯¦ç»†çš„DEBUGçº§åˆ«æ—¥å¿—
# 3. å¯ç”¨æ‰€æœ‰æµ‹è¯•åŠŸèƒ½ï¼ŒåŒ…æ‹¬è¯»å†™æ“ä½œæµ‹è¯•
# 4. æ”¶é›†è¯¦ç»†çš„ç»Ÿè®¡ä¿¡æ¯ç”¨äºåˆ†æ
# 5. å‘Šè­¦é€šçŸ¥å‘é€åˆ°å¼€å‘å·¥å…·å’Œæœ¬åœ°æœåŠ¡
# 6. è¾ƒçŸ­çš„è¶…æ—¶æ—¶é—´ï¼Œå› ä¸ºéƒ½æ˜¯æœ¬åœ°æœåŠ¡
# 7. åŒ…å«å‰ç«¯å¼€å‘æœåŠ¡å™¨ç­‰å¼€å‘ç‰¹æœ‰çš„æœåŠ¡