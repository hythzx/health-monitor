# ç”Ÿäº§ç¯å¢ƒé…ç½®æ¨¡æ¿
# é’ˆå¯¹ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–çš„é…ç½®ï¼Œæ³¨é‡ç¨³å®šæ€§å’Œå¯é æ€§

global:
  check_interval: 60        # ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥é—´éš”ç¨é•¿ï¼Œå‡å°‘ç³»ç»Ÿè´Ÿè½½
  log_level: WARNING        # ç”Ÿäº§ç¯å¢ƒåªè®°å½•è­¦å‘Šå’Œé”™è¯¯
  log_file: /var/log/health-monitor/production.log
  log_max_size: 500         # æ›´å¤§çš„æ—¥å¿—æ–‡ä»¶
  log_backup_count: 10      # ä¿ç•™æ›´å¤šæ—¥å¿—æ–‡ä»¶

services:
  # ä¸»æ•°æ®åº“ - é«˜é¢‘ç‡ç›‘æ§
  primary-database:
    type: mysql
    host: db-primary.internal
    port: 3306
    username: monitor_user
    password: "${DB_MONITOR_PASSWORD}"  # ä½¿ç”¨ç¯å¢ƒå˜é‡
    database: production
    timeout: 15               # ç”Ÿäº§ç¯å¢ƒè¶…æ—¶æ—¶é—´æ›´é•¿
    check_interval: 30        # å…³é”®æœåŠ¡æ£€æŸ¥æ›´é¢‘ç¹
    test_queries: false       # ç”Ÿäº§ç¯å¢ƒé¿å…é¢å¤–æŸ¥è¯¢
    collect_status: true      # æ”¶é›†çŠ¶æ€ç”¨äºç›‘æ§
    test_database_access: true

  # åªè¯»å‰¯æœ¬æ•°æ®åº“
  readonly-database:
    type: mysql
    host: db-readonly.internal
    port: 3306
    username: readonly_monitor
    password: "${DB_READONLY_PASSWORD}"
    database: production
    timeout: 10
    check_interval: 60        # å‰¯æœ¬æ£€æŸ¥é¢‘ç‡å¯ä»¥ä½ä¸€äº›
    test_queries: false
    collect_status: false
    test_database_access: true

  # Redisé›†ç¾¤
  redis-cluster:
    type: redis
    host: redis-cluster.internal
    port: 6379
    password: "${REDIS_PASSWORD}"
    database: 0
    timeout: 10
    check_interval: 30
    test_operations: false    # ç”Ÿäº§ç¯å¢ƒä¸æ‰§è¡Œå†™æ“ä½œæµ‹è¯•
    collect_info: true

  # æ¶ˆæ¯é˜Ÿåˆ—
  message-queue:
    type: emqx
    host: mq-cluster.internal
    port: 1883
    username: monitor_user
    password: "${MQ_PASSWORD}"
    client_id: health_monitor_prod
    timeout: 20
    check_interval: 45
    check_method: http        # ä½¿ç”¨HTTP APIï¼Œé¿å…MQTTè¿æ¥å¼€é”€
    api_port: 18083
    api_username: admin
    api_password: "${MQ_API_PASSWORD}"
    collect_stats: true

  # æ ¸å¿ƒAPIæœåŠ¡
  core-api:
    type: restful
    url: https://api.internal/health
    method: GET
    timeout: 15
    check_interval: 30
    headers:
      Authorization: "Bearer ${API_MONITOR_TOKEN}"
      User-Agent: "HealthMonitor-Prod/1.0"
    expected_status: 200
    expected_content: "healthy"
    validate_json: true
    required_json_fields:
      - status
      - timestamp
    collect_response_stats: true

  # ç”¨æˆ·æœåŠ¡API
  user-service:
    type: restful
    url: https://user-service.internal/health
    method: GET
    timeout: 12
    check_interval: 45
    headers:
      X-API-Key: "${USER_SERVICE_API_KEY}"
    expected_status: 200
    validate_json: true
    collect_response_stats: false

  # å¤–éƒ¨æ”¯ä»˜æœåŠ¡
  payment-gateway:
    type: restful
    url: https://payment-api.external.com/status
    method: GET
    timeout: 30               # å¤–éƒ¨æœåŠ¡è¶…æ—¶æ—¶é—´æ›´é•¿
    check_interval: 300       # å¤–éƒ¨æœåŠ¡æ£€æŸ¥é¢‘ç‡æ›´ä½
    headers:
      Authorization: "Bearer ${PAYMENT_API_TOKEN}"
    expected_status: [200, 202]
    collect_response_stats: false

alerts:
  # ä¸»è¦å‘Šè­¦æ¸ é“ - é’‰é’‰
  - name: primary-dingtalk
    type: http
    url: "${DINGTALK_WEBHOOK_URL}"
    method: POST
    timeout: 15
    max_retries: 5            # ç”Ÿäº§ç¯å¢ƒæ›´å¤šé‡è¯•
    retry_delay: 2.0
    retry_backoff: 1.5
    headers:
      Content-Type: "application/json"
    template: |
      {
        "msgtype": "text",
        "text": {
          "content": "ğŸš¨ ç”Ÿäº§ç¯å¢ƒå‘Šè­¦\n\næœåŠ¡: {{service_name}}\nç±»å‹: {{service_type}}\nçŠ¶æ€: {{status}}\næ—¶é—´: {{timestamp}}\nå“åº”æ—¶é—´: {{response_time}}ms\né”™è¯¯: {{error_message}}\n\n@æ‰€æœ‰äºº è¯·ç«‹å³å¤„ç†ï¼"
        }
      }

  # å¤‡ç”¨å‘Šè­¦æ¸ é“ - ä¼ä¸šå¾®ä¿¡
  - name: backup-wechat
    type: http
    url: "${WECHAT_WEBHOOK_URL}"
    method: POST
    timeout: 15
    max_retries: 3
    retry_delay: 1.0
    retry_backoff: 2.0
    headers:
      Content-Type: "application/json"
    template: |
      {
        "msgtype": "markdown",
        "markdown": {
          "content": "## ğŸš¨ ç”Ÿäº§ç¯å¢ƒå‘Šè­¦\n\n**æœåŠ¡**: {{service_name}}\n**ç±»å‹**: {{service_type}}\n**çŠ¶æ€**: <font color=\"warning\">{{status}}</font>\n**æ—¶é—´**: {{timestamp}}\n**å“åº”æ—¶é—´**: {{response_time}}ms\n**é”™è¯¯**: {{error_message}}"
        }
      }

  # é‚®ä»¶å‘Šè­¦ï¼ˆä¸¥é‡é—®é¢˜ï¼‰
  - name: email-critical
    type: http
    url: "${EMAIL_API_URL}"
    method: POST
    timeout: 30
    max_retries: 3
    retry_delay: 5.0
    retry_backoff: 2.0
    headers:
      Authorization: "Bearer ${EMAIL_API_TOKEN}"
      Content-Type: "application/json"
    template: |
      {
        "to": ["ops-team@company.com", "on-call@company.com"],
        "subject": "ğŸš¨ CRITICAL: Production Service Alert - {{service_name}}",
        "html": "<h2>Production Service Alert</h2><p><strong>Service:</strong> {{service_name}} ({{service_type}})</p><p><strong>Status:</strong> {{status}}</p><p><strong>Time:</strong> {{timestamp}}</p><p><strong>Response Time:</strong> {{response_time}}ms</p><p><strong>Error:</strong> {{error_message}}</p><p>Please investigate immediately.</p>"
      }

# ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹ï¼š
# 1. æ‰€æœ‰æ•æ„Ÿä¿¡æ¯ä½¿ç”¨ç¯å¢ƒå˜é‡
# 2. æ£€æŸ¥é—´éš”é€‚ä¸­ï¼Œé¿å…å¯¹ç”Ÿäº§ç³»ç»Ÿé€ æˆå‹åŠ›
# 3. é…ç½®å¤šä¸ªå‘Šè­¦æ¸ é“ç¡®ä¿å¯é æ€§
# 4. é¿å…åœ¨ç”Ÿäº§æ•°æ®åº“ä¸Šæ‰§è¡Œä¸å¿…è¦çš„æµ‹è¯•æŸ¥è¯¢
# 5. è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œè€ƒè™‘ç½‘ç»œå»¶è¿Ÿ
# 6. ç›‘æ§å¤–éƒ¨ä¾èµ–æœåŠ¡ï¼Œä½†é¢‘ç‡è¦ä½